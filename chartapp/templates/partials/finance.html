

{% extends "partials/base.html" %}
{% block content %}
{% load static %}


<div class="px-3">

    <!-- Start Content-->
    <div class="container-fluid">

        <!-- start page title -->
        
            <div class="row">
                <div class="col-lg-6">
                    <h4 class="header-title mb-0">Finance Dashboard</h4>
                </div>
                <div class="col-lg-6">
                   <div class="d-none d-lg-block">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="{% url 'index' %}">Salvador</a></li>
                        <li class="breadcrumb-item active"> Finance Dashboard</li>
                    </ol>
                   </div>
                </div>
            </div>
        
        <!-- end page title -->

        <div class="row">
            <div class="col-md-6 col-xl-3">
                <div class="smallcard">
                    <div class="card-body">
                        <div class="mb-4">
                            
                            <h6 class="card-title mb-0" id="metric1-heading"></h6>
                            <span class="badge badge-soft-primary float-end">Daily</span>
                        </div>
                        <div class="row d-flex align-items-center mb-4">
                            <div class="col-8">
                                <h2 id="metric1-data" class="d-flex align-items-center mb-0">
                                    
                                </h2>
                            </div>
                            <div class="col-4 text-end">
                                <span id="metric1-percentage" class="text-muted"> 
                                <span class="mdi mdi-arrow-up text-success"></span>
                            </div>
                        </div>

                        <div class="progress shadow-sm" style="height: 5px;">
                            <div class="progress-bar bg-success" role="progressbar" style="width: 57%;">
                            </div>
                        </div>
                    </div>
                    <!--end card body-->
                </div><!-- end card-->
            </div> <!-- end col-->

            <div class="col-md-6 col-xl-3">
                <div class="smallcard">
                    <div class="card-body">
                        <div class="mb-4">
                            <h6 id="metric2-heading" class="card-title mb-0"></h6>
                            <span class="badge badge-soft-primary float-end">Per Week</span>
                        </div>
                        <div class="row d-flex align-items-center mb-4">
                            <div class="col-8">
                                <h2 id="metric2-data" class="d-flex align-items-center mb-0">
                                    
                                </h2>
                            </div>
                            <div class="col-4 text-end">
                                <span id="metric2-percentage" class="text-muted">
                                    <i class="mdi mdi-arrow-down text-danger"></i></span>
                            </div>
                        </div>

                        <div class="progress shadow-sm" style="height: 5px;">
                            <div class="progress-bar bg-danger" role="progressbar" style="width: 57%;">
                            </div>
                        </div>
                    </div>
                    <!--end card body-->
                </div><!-- end card-->
            </div> <!-- end col-->

            <div class="col-md-6 col-xl-3">
                <div class="smallcard">
                    <div class="card-body">
                        <div class="mb-4">
                            
                            <h6 id="metric3-heading" class="card-title mb-0"></h6>
                            <span class="badge badge-soft-primary float-end">Per Month</span>
                        </div>
                        <div class="row d-flex align-items-center mb-4">
                            <div class="col-8">
                                <h2 id="metric3-data" class="d-flex align-items-center mb-0">
                                    
                                </h2>
                            </div>
                            <div class="col-4 text-end">
                                <span id="metric3-percentage" class="text-muted"> <i
                                        class="mdi mdi-arrow-up text-success"></i></span>
                            </div>
                        </div>

                        <div class="progress shadow-sm" style="height: 5px;">
                            <div class="progress-bar bg-warning" role="progressbar" style="width: 57%;">
                            </div>
                        </div>
                    </div>
                    <!--end card body-->
                </div>
                <!--end card-->
            </div> <!-- end col-->

            <div class="col-md-6 col-xl-3">
                <div class="smallcard">
                    <div class="card-body">
                        <div class="mb-4">
                            <h6 id="metric4-heading" class="card-title mb-0"></h6>
                            <span class="badge badge-soft-primary float-end">All Time</span>
                            
                        </div>
                        <div class="row d-flex align-items-center mb-4">
                            <div class="col-8">
                                <h2 id="metric4-data" class="d-flex align-items-center mb-0">
                                   
                                </h2>
                            </div>
                            <div class="col-4 text-end">
                                <span id="metric4-percentage" class="text-muted"><i
                                        class="mdi mdi-arrow-down text-danger"></i></span>
                            </div>
                        </div>

                        <div class="progress shadow-sm" style="height: 5px;">
                            <div class="progress-bar bg-info" role="progressbar" style="width: 57%;"></div>
                        </div>
                    </div>
                    <!--end card body-->
                </div><!-- end card-->
            </div> <!-- end col-->
        </div>
        <!-- end row-->


        <div class="row">
            <div class="col-lg-6">
                <div class="card">
                    <div class="card-body">
                        <h4 class="header-title">Cashflow In - Out</h4>

                        <div id="cardCollpase11" class="collapse show" dir="ltr">
                            <div id="apex-mixed-3" class="apex-charts pt-3" data-colors="#00acc1,#ebf2f6,#f672a7"></div>
                        </div> <!-- collapsed end -->
                    </div>
                    <!--end card body-->

                </div>
                <!--end card-->
            </div>
            <!--end col-->
            <div class="col-lg-6">
                <div class="card">
                    <div class="card-body">

                        <h4 class="card-title">Due Orders</h4>
                        <p class="card-subtitle mb-4 font-size-13">Transaction period from 21 July to 25 Aug
                        </p>

                        <div class="table-responsive">
                            <table class="table table-centered table-striped table-nowrap mb-0">
                                <thead>
                                    <tr>
                                        <th>Customer</th>
                                        <th>Order</th>
                                        <th>Nos.</th>
                                        <th>Cash</th>
                                        
                                    </tr>
                                </thead>
                                <tbody id="finance-table-body">
                                    <!-- Data will be dynamically inserted here -->
                                </tbody>
                            </table>
                        </div>

                    </div>
                    <!--end card body-->

                </div>
                <!--end card-->
            </div>
            <!--end col-->

        </div>
        <!--end row-->


        

        <div class="row">
            <div class="col-lg-6">
                <div class="card">
                    <div class="card-body">
                        <h4 class="header-title">Lead Conversion Rate</h4>
                        <div class="mt-4 chartjs-chart">
                            <canvas id="leadConversionChart" height="50"> </canvas>
                        </div>

                    </div> <!-- end card-body-->
                </div> <!-- end card-->
            </div> <!-- end col -->

            <div class="col-lg-6">
                <div class="card">
                    <div class="card-body">
                        <h4 class="header-title">Company Revenue</h4>

                                    <div id="cardCollpase6" class="collapse show" dir="ltr">
                                        <div id="apex-column-2" class="apex-charts pt-3" data-colors="#00acc1"></div>
                                    </div>

                    </div> <!-- end card-body-->
                </div> <!-- end card-->
            </div> <!-- end col -->
            
        </div> <!-- endrow -->
        <div class="row">
            <div class="card">
                <div class="card-body">
                    
                    <h4 class="card-title d-inline-block">Liquidity</h4>

                    <div style="width: 100%;">
                        <canvas id="line-chart" height="100" data-colors="#1abc9c,#f1556c"></canvas>
                    </div>
                    <div class="row text-center mt-4">
                        <div class="col-6">
                            <h4>1.7</h4>
                            <p class="text-muted mb-0">Liquidity ratio</p>
                        </div>
                        <div class="col-6">
                            <h4>27</h4>
                            <p class="text-muted mb-0">Solvency</p>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div> <!-- container -->

</div> <!-- content -->
<script>

    // Fetch data from the API
    fetch('https://ceodb-production.up.railway.app/api/metrics/')
    .then(response => response.json())
    .then(data => {
        // Assuming the response is a list of metrics
        const metrics = data;

        // Loop through each metric and populate the corresponding DOM elements
        metrics.forEach((metric, index) => {
        // Assuming you have HTML elements with ids like metric1-heading, metric2-heading, etc.
        document.getElementById(`metric${index + 1}-heading`).textContent = metric.heading;
        // Check if the metric is 'Revenue' or 'Expenses' and add the $ symbol accordingly
        const formattedData = (metric.heading === "Revenue" || metric.heading === "Expenses") 
            ? `$${metric.data}` 
            : metric.data;

        document.getElementById(`metric${index + 1}-data`).textContent = formattedData;
        document.getElementById(`metric${index + 1}-percentage`).textContent = `${metric.percentage}%`;
    });

    })
    .catch(error => console.error('Error fetching metrics data:', error));


        function loadFinanceData() {
        fetch('https://ceodb-production.up.railway.app/api/finance/')  // API URL for finance model
            .then(response => response.json())  // Parse the JSON response
            .then(data => {
                const financeTableBody = document.getElementById('finance-table-body');
                financeTableBody.innerHTML = '';  // Clear the table body before adding new data

                // Loop through the finance data and populate the table
                data.forEach(finance => {
                    const row = `
                        <tr>
                            <td class="table-user">
                                <a href="javascript:void(0);" class="text-body font-weight-semibold">${finance.Client}</a>
                            </td>
                            <td>${finance.order}</td>
                            <td>${finance.amount}</td>
                            <td>${finance.cash}</td>
                        </tr>
                    `;
                    financeTableBody.insertAdjacentHTML('beforeend', row);  // Add the new row to the table
                });
            })
            .catch(error => {
                console.error('Error fetching finance data:', error);
            });
    }

    // Call the function to load finance data when the page loads
    document.addEventListener('DOMContentLoaded', loadFinanceData);

    function loadLeadConversionChart() {
    fetch('https://ceodb-production.up.railway.app/api/leadconversion/')  // API URL for lead conversion model
        .then(response => response.json())  // Parse the JSON response
        .then(data => {
            const Leads = [];
            const Conversions = [];
            const conversionRate = [];
            const labels = [];  // Create an array for labels

            // Loop through the lead conversion data and populate the arrays
            data.forEach(leadconversion => {
                Leads.push(leadconversion.leads_generated);
                Conversions.push(leadconversion.leads_converted);
                conversionRate.push(leadconversion.conversion_rate);

                // Generate the label by combining month and year
                labels.push(`${leadconversion.month} ${leadconversion.year}`);
            });

            // Now use the dynamically generated labels for the chart
            const leadConversionChart = new Chart(document.getElementById('leadConversionChart'), {
                type: 'doughnut',
                data: {
                    labels: labels,  // Use the dynamically generated labels
                    datasets: [
                        {
                            label: 'Leads Generated',
                            data: Leads,
                            backgroundColor: [
                                'rgba(255, 99, 132, 0.9)',
                                'rgba(54, 162, 235, 0.9)',
                                'rgba(75, 192, 192, 0.9)',
                                'rgba(255, 159, 64, 0.9)',
                                'rgba(153, 102, 255, 0.9)',
                                'rgba(255, 205, 86, 0.9)'
                            ],
                            borderColor: [
                                'rgba(255, 99, 132, 1)',
                                'rgba(54, 162, 235, 1)',
                                'rgba(75, 192, 192, 1)',
                                'rgba(255, 159, 64, 1)',
                                'rgba(153, 102, 255, 1)',
                                'rgba(255, 205, 86, 1)'
                            ],
                            borderWidth: 1,
                            hoverOffset: 8,
                        },
                        {
                            label: 'Leads Converted',
                            data: Conversions,
                            backgroundColor: [
                                'rgba(255, 206, 86, 0.9)',
                                'rgba(75, 192, 192, 0.9)',
                                'rgba(54, 162, 235, 0.9)',
                                'rgba(255, 99, 132, 0.9)',
                                'rgba(153, 102, 255, 0.9)',
                                'rgba(255, 159, 64, 0.9)'
                            ],
                            borderColor: [
                                'rgba(255, 206, 86, 1)',
                                'rgba(75, 192, 192, 1)',
                                'rgba(54, 162, 235, 1)',
                                'rgba(255, 99, 132, 1)',
                                'rgba(153, 102, 255, 1)',
                                'rgba(255, 159, 64, 1)'
                            ],
                            borderWidth: 1,
                            hoverOffset: 8,
                        },
                        {
                            label: 'Conversion Rate (%)',
                            data: conversionRate,
                            backgroundColor: [
                                'rgba(153, 102, 255, 0.9)',
                                'rgba(255, 159, 64, 0.9)',
                                'rgba(255, 205, 86, 0.9)',
                                'rgba(75, 192, 192, 0.9)',
                                'rgba(54, 162, 235, 0.9)',
                                'rgba(255, 99, 132, 0.9)'
                            ],
                            borderColor: [
                                'rgba(153, 102, 255, 1)',
                                'rgba(255, 159, 64, 1)',
                                'rgba(255, 205, 86, 1)',
                                'rgba(75, 192, 192, 1)',
                                'rgba(54, 162, 235, 1)',
                                'rgba(255, 99, 132, 1)'
                            ],
                            borderWidth: 1,
                            hoverOffset: 8,
                        }
                    ]
                },
                options: {
                    responsive: true,
                    cutout: '70%',
                    radius: '60%',
                    plugins: {
                        legend: {
                            labels: {
                                color: [
                                    'rgba(255, 99, 132, 1)',
                                    'rgba(54, 162, 235, 1)',
                                    'rgba(75, 192, 192, 1)',
                                    'rgba(255, 159, 64, 1)',
                                    'rgba(153, 102, 255, 1)',
                                    'rgba(255, 205, 86, 1)'
                                ]
                            }
                        }
                    }
                }
            });
        })
        .catch(error => {
            console.error('Error fetching lead conversion data:', error);
        });
}

// Call the function to load lead conversion chart data when the page loads
document.addEventListener('DOMContentLoaded', loadLeadConversionChart);

    // Function to fetch finance data and create the chart
    function loadFinanceChart() {
        fetch('https://ceodb-production.up.railway.app/api/finance/')  // Fetch finance data from API
            .then(response => response.json())  // Parse JSON response
            .then(data => {
                // Extract data for the chart
                const labels = ['Jan', 'Feb', 'Mar', 'Apr', 'May'];  // Add labels like 'Jan', 'Feb', 'Mar', etc.
                const liquidityData = [];
                const assetsData = [];
                const liabilityData = [];

                // Populate the arrays with data from the API response
                data.forEach(finance => {
                    
                    liquidityData.push(finance.liquid);
                    assetsData.push(finance.asset);
                    liabilityData.push(finance.liab);
                });

                // Create the chart after data has been fetched
                const ctx = document.getElementById('line-chart').getContext('2d');
                const liquidityChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,  // Use the fetched labels
                        datasets: [
                            {
                                label: 'Liquidity',
                                data: liquidityData,  // Use the fetched liquidity data
                                backgroundColor: 'rgba(75, 192, 192, 0.2)',
                                borderColor: 'rgba(75, 192, 192, 1)',
                                borderWidth: 3,
                                fill: true,
                                tension: 0.4
                            },
                            {
                                label: 'Assets',
                                data: assetsData,  // Use the fetched assets data
                                backgroundColor: 'rgba(255, 99, 132, 0.2)',
                                borderColor: 'rgba(255, 99, 132, 1)',
                                borderWidth: 3,
                                borderDash: [10, 3],
                                fill: false,
                                tension: 0.4
                            },
                            {
                                label: 'Liability',
                                data: liabilityData,  // Use the fetched liability data
                                backgroundColor: 'rgba(255, 99, 132, 0.2)',
                                borderColor: 'rgba(255, 99, 132, 1)',
                                borderWidth: 3,
                                borderDash: [10, 3],
                                fill: false,
                                tension: 0.4
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                display: true,
                            },
                            tooltip: {
                                mode: 'index',
                                intersect: false,
                            },
                        },
                        interaction: {
                            mode: 'nearest',
                            axis: 'x',
                            intersect: false
                        },
                        scales: {
                            x: {
                                display: true,
                                title: {
                                    display: true,
                                    text: 'Month'
                                },
                                grid: {
                                    color: 'rgba(0, 0, 0, 0.06)'  // Reduced opacity for x-axis grid lines
                                }
                            },
                            y: {
                                display: true,
                                title: {
                                    display: true,
                                    text: 'Value'
                                },
                                suggestedMin: 0,
                                suggestedMax: 120,
                                grid: {
                                    color: 'rgba(0, 0, 0, 0.06)'  // Reduced opacity for y-axis grid lines
                                }
                            }
                        }
                    }
                });
            })
            .catch(error => {
                console.error('Error fetching finance data for chart:', error);
            });
    }

    // Call the function to load finance data and initialize the chart
    document.addEventListener('DOMContentLoaded', loadFinanceChart);



</script>




{% endblock %}





{{ redirect_to_login_immediately }}
