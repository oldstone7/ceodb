{% extends "partials/base.html" %}
{% block content %}
{% load static %}

<div class="px-3">

    <!-- Start Content-->
    <div class="container-fluid">

        <!-- start page title -->
        <div class="py-3 py-lg-4">
            <div class="row">
                <div class="col-lg-6">
                    <h4 class="page-title mb-0"> Operations Dashboard</h4>
                </div>
                <div class="col-lg-6">
                   <div class="d-none d-lg-block">
                    <ol class="breadcrumb m-0 float-end">
                        <li class="breadcrumb-item"><a href="{% url 'index' %}">Salvador</a></li>
                        <li class="breadcrumb-item active"> Operations Dashboard</li>
                    </ol>
                   </div>
                </div>
            </div>
        </div>
        <!-- end page title -->

        <div class="row">
            <div class="col-md-6 col-xl-3">
                <div class="smallcard">
                    <div class="card-body">
                        <div class="mb-4">
                            
                            <h6 class="card-title mb-0" id="metric1-heading"></h6>
                            <span class="badge badge-soft-primary float-end">Daily</span>
                        </div>
                        <div class="row d-flex align-items-center mb-4">
                            <div class="col-8">
                                <h2 id="metric1-data" class="d-flex align-items-center mb-0">
                                    
                                </h2>
                            </div>
                            <div class="col-4 text-end">
                                <span id="metric1-percentage" class="text-muted"> 
                                <span class="mdi mdi-arrow-up text-success"></span>
                            </div>
                        </div>

                        <div class="progress shadow-sm" style="height: 5px;">
                            <div class="progress-bar bg-success" role="progressbar" style="width: 57%;">
                            </div>
                        </div>
                    </div>
                    <!--end card body-->
                </div><!-- end card-->
            </div> <!-- end col-->

            <div class="col-md-6 col-xl-3">
                <div class="smallcard">
                    <div class="card-body">
                        <div class="mb-4">
                            <h6 id="metric2-heading" class="card-title mb-0"></h6>
                            <span class="badge badge-soft-primary float-end">Per Week</span>
                        </div>
                        <div class="row d-flex align-items-center mb-4">
                            <div class="col-8">
                                <h2 id="metric2-data" class="d-flex align-items-center mb-0">
                                    
                                </h2>
                            </div>
                            <div class="col-4 text-end">
                                <span id="metric2-percentage" class="text-muted">
                                    <i class="mdi mdi-arrow-down text-danger"></i></span>
                            </div>
                        </div>

                        <div class="progress shadow-sm" style="height: 5px;">
                            <div class="progress-bar bg-danger" role="progressbar" style="width: 57%;">
                            </div>
                        </div>
                    </div>
                    <!--end card body-->
                </div><!-- end card-->
            </div> <!-- end col-->

            <div class="col-md-6 col-xl-3">
                <div class="smallcard">
                    <div class="card-body">
                        <div class="mb-4">
                            
                            <h6 id="metric3-heading" class="card-title mb-0"></h6>
                            <span class="badge badge-soft-primary float-end">Per Month</span>
                        </div>
                        <div class="row d-flex align-items-center mb-4">
                            <div class="col-8">
                                <h2 id="metric3-data" class="d-flex align-items-center mb-0">
                                    
                                </h2>
                            </div>
                            <div class="col-4 text-end">
                                <span id="metric3-percentage" class="text-muted"> <i
                                        class="mdi mdi-arrow-up text-success"></i></span>
                            </div>
                        </div>

                        <div class="progress shadow-sm" style="height: 5px;">
                            <div class="progress-bar bg-warning" role="progressbar" style="width: 57%;">
                            </div>
                        </div>
                    </div>
                    <!--end card body-->
                </div>
                <!--end card-->
            </div> <!-- end col-->

            <div class="col-md-6 col-xl-3">
                <div class="smallcard">
                    <div class="card-body">
                        <div class="mb-4">
                            <h6 id="metric4-heading" class="card-title mb-0"></h6>
                            <span class="badge badge-soft-primary float-end">All Time</span>
                            
                        </div>
                        <div class="row d-flex align-items-center mb-4">
                            <div class="col-8">
                                <h2 id="metric4-data" class="d-flex align-items-center mb-0">
                                   
                                </h2>
                            </div>
                            <div class="col-4 text-end">
                                <span id="metric4-percentage" class="text-muted"><i
                                        class="mdi mdi-arrow-down text-danger"></i></span>
                            </div>
                        </div>

                        <div class="progress shadow-sm" style="height: 5px;">
                            <div class="progress-bar bg-info" role="progressbar" style="width: 57%;"></div>
                        </div>
                    </div>
                    <!--end card body-->
                </div><!-- end card-->
            </div> <!-- end col-->
        </div>
        <!-- end row-->
        


        
        <div class="row">
            <div class="col-lg-6">
                <div class="card">
                    <div class="card-body">
                        <h4 class="header-title">Supply Chain</h4>

                        <div class="mt-4 chartjs-chart">
                            <canvas id="supplyChainChart" height="250" data-colors="#4a81d4,#fa5c7c,#4fc6e1,#ebeff2"> </canvas>
                        </div>

                    </div> <!-- end card-body-->
                </div> <!-- end card-->
            </div> <!-- end col -->
            <div class="col-lg-6">
                <div class="card">
                    <div class="card-body">
                        <h4 class="header-title">Inventory</h4>

                        <div class="mt-4 chartjs-chart">
                            <canvas id="inventoryChart" height="300" data-colors="#39afd1,#a17fe0"></canvas>
                        </div>
                    </div> <!-- end card-body-->
                </div> <!-- end card-->
            </div> <!-- end col -->
        </div>
        <div class="row">
            <div class="col-lg-7">
                <div class="card">
                    <div class="card-body">
                        <h4 class="header-title">Production rates</h4>

                        <div class="mt-4 chartjs-chart">
                            <canvas id="productionOutputChart" height="200" data-colors="#4a81d4,#fa5c7c,#4fc6e1,#ebeff2"> </canvas>
                        </div>

                    </div> <!-- end card-body-->
                </div> <!-- end card-->
            </div> <!-- end col -->
            <div class="col-lg-5">
                <div class="card">
                    <div class="card-body">
                        <h4 class="header-title">Efficiency</h4>

                        <div class="mt-4 chartjs-chart">
                            <canvas id="efficiencyChart" height="300" data-colors="#39afd1,#a17fe0"></canvas>
                        </div>
                    </div> <!-- end card-body-->
                </div> <!-- end card-->
            </div> <!-- end col -->
        </div>
    </div> <!-- container -->

</div>




<script>

fetch('https://ceodb-production.up.railway.app/api/metrics/')
        .then(response => response.json())
        .then(data => {
            // Assuming the response is a list of metrics
            const metrics = data;

            // Loop through each metric and populate the corresponding DOM elements
            metrics.forEach((metric, index) => {
                // Assuming you have HTML elements with ids like metric1-heading, metric2-heading, etc.
                document.getElementById(`metric${index + 1}-heading`).textContent = metric.heading;
                document.getElementById(`metric${index + 1}-data`).textContent = `$${metric.data}`;
                document.getElementById(`metric${index + 1}-percentage`).textContent = `${metric.percentage}%`;
            });
        })
        .catch(error => console.error('Error fetching metrics data:', error));

document.addEventListener('DOMContentLoaded', function () {
    fetch('https://ceodb-production.up.railway.app/api/supplychain/')
        .then(response => response.json())
        .then(data => {
            
            const supplychain_labels = [];
            const on_time_delivery_rate = [];
            const cost_per_unit = [];
            const delivery_lead_time = [];
            data.forEach(supplychain => {
                supplychain_labels.push(supplychain.label);
                on_time_delivery_rate.push(supplychain.on_time_delivery_rate);
                cost_per_unit.push(supplychain.cost_per_unit);
                delivery_lead_time.push(supplychain.delivery_lead_time);
            });
        


            const supplyChainChart = new Chart(document.getElementById('supplyChainChart'), {
            type: 'radar',
            data: {
                labels: supplychain_labels,
                datasets: [
                    {
                        label: 'On-Time Delivery Rate (%)',
                        data: on_time_delivery_rate,
                        backgroundColor: 'rgba(255, 99, 132, 0.4)',
                        borderColor: 'rgba(255, 99, 132, 1)',
                        borderWidth: 2
                    },
                    {
                        label: 'Cost Per Unit ($)',
                        data: cost_per_unit,
                        backgroundColor: 'rgba(54, 162, 235, 0.4)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 2
                    },
                    {
                        label: 'Delivery Lead Time (Days)',
                        data: delivery_lead_time,
                        backgroundColor: 'rgba(255, 255, 0, 0.4)',
                        borderColor: 'rgba(255, 255, 0, 1)',
                        borderWidth: 2
                    }
                ]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        labels: {
                            font: {
                                size: 12  // Increase the font size of labels
                            }
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return `${context.dataset.label}: ${context.raw}`;
                            }
                        }
                    }
                },
                scales: {
                    r: {  // 'r' is used for radial axis in radar charts
                        ticks: {
                            font: {
                                size: 14, // Increase font size for axis labels
                            },
                            color: '#000', // Color for axis labels
                        },
                        pointLabels: {
                            font: {
                                size: 14, // Increase font size for the point labels
                            },
                            color: '#000' // Color for point labels
                        }
                    }
                }
            }
        });

        })
        .catch(error => console.error('Error fetching supply chain data:', error));

})

document.addEventListener('DOMContentLoaded', function () {
    fetch('https://ceodb-production.up.railway.app/api/inventory/')
        .then(response => response.json())
        .then(data => {
            const inventory_labels = [];
            const current_stock = [];
            const reorder_level = [];
            const stock_turnover_rate = [];
            data.forEach(inventory => {
                inventory_labels.push(inventory.item_name);
                current_stock.push(inventory.current_stock);
                reorder_level.push(inventory.reorder_level);
                stock_turnover_rate.push(inventory.stock_turnover_rate);
            });
            const inventoryChart = new Chart(document.getElementById('inventoryChart'), {
            type: 'bar',
            data: {
                labels: inventory_labels,
                datasets: [
                    {
                        label: 'Current Stock',
                        data: current_stock ,
                        backgroundColor: 'rgba(33, 48, 159, 0.3)',
                        borderColor: 'rgba(33, 48, 159, 0.7)',
                        borderWidth: 1
                    },
                    {
                        label: 'Reorder Level',
                        data: reorder_level,
                        backgroundColor: 'rgba(255, 225, 0, 0.3)',
                        borderColor: 'rgba(255, 225, 0, 0.7)',
                        borderWidth: 1
                    },
                    {
                        label: 'Stock Turnover Rate',
                        data: stock_turnover_rate,
                        backgroundColor: 'rgba(255, 0, 0, 0.3)',
                        borderColor: 'rgba(255, 0, 0, 0.7)',
                        borderWidth: 1
                    }
                ]
            },
            options: {
                responsive: true,
            }
        });
})  
    // Inventory Bar Chart
.catch(error => console.error('Error fetching inventory data:', error));
});
    
document.addEventListener('DOMContentLoaded', function () {
fetch('https://ceodb-production.up.railway.app/api/production/')
    .then(response => response.json())
    .then(data => {
        const production_labels = [];
        const units_produced = [];
        const production_time = [];
        const defect_rate = [];
        data.forEach(production => {
            production_labels.push(production.product_name);
            units_produced.push(production.units_produced);
            production_time.push(production.production_time);
            defect_rate.push(production.defect_rate);
        });
        const ctx = document.getElementById('productionOutputChart').getContext('2d');
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: production_labels,
                datasets: [
                    {
                        label: 'Units Produced',
                        data: units_produced,
                        borderColor: 'rgba(75, 192, 192, 1)',
                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                        yAxisID: 'y-axis-1',
                    },
                    {
                        label: 'Production Time (Hours)',
                        data: production_time,
                        borderColor: 'rgba(153, 102, 255, 1)',
                        backgroundColor: 'rgba(153, 102, 255, 0.2)',
                        yAxisID: 'y-axis-2',
                    },
                    {
                        label: 'Defect Rate (%)',
                        data: defect_rate,
                        borderColor: 'rgba(255, 99, 132, 1)',
                        backgroundColor: 'rgba(255, 99, 132, 0.2)',
                        yAxisID: 'y-axis-2',
                    }
                ]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        'y-axis-1': {
                            type: 'linear',
                            position: 'left',
                            title: {
                                display: true,
                                text: 'Units Produced'
                            }
                        },
                        'y-axis-2': {
                            type: 'linear',
                            position: 'right',
                            title: {
                                display: true,
                                text: 'Production Time / Defect Rate'
                            },
                            grid: {
                                drawOnChartArea: false
                            }
                        }
                    }
                },
                plugins: {
                    legend: {
                        position: 'top',
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return `${context.dataset.label}: ${context.raw}`;
                            }
                        }
                    }
                }
            }
        });
        })
.catch(error => console.error('Error fetching production data:', error));
})     


document.addEventListener('DOMContentLoaded', function () {
    fetch('https://ceodb-production.up.railway.app/api/efficiency/')
        .then(response => response.json())
        .then(data => {
            const efficiency_labels = [];
            const machine_utilization_rate = [];
            const labor_efficiency_rate = [];
            const energy_consumption = [];
            
            // Populate data arrays
            data.forEach(efficiency => {
                efficiency_labels.push(efficiency.department_name);
                machine_utilization_rate.push(efficiency.machine_utilization_rate);
                labor_efficiency_rate.push(efficiency.labor_efficiency_rate);
                energy_consumption.push(efficiency.energy_consumption);
            });
            
            // Create the chart once with populated data
            const efficiencyChart = new Chart(document.getElementById('efficiencyChart'), {
                type: 'bar',
                data: {
                    labels: efficiency_labels,
                    datasets: [
                        {
                            label: 'Machine Utilization Rate (%)',
                            data: machine_utilization_rate,
                            backgroundColor: 'rgba(255, 99, 132, 1)',
                            borderColor: 'rgba(255, 99, 132, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'Labor Efficiency Rate (%)',
                            data: labor_efficiency_rate,
                            backgroundColor: 'rgba(54, 162, 235, 1)',
                            borderColor: 'rgba(54, 162, 235, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'Energy Consumption (kWh)',
                            data: energy_consumption,
                            backgroundColor: 'rgba(75, 192, 192, 1)',
                            borderColor: 'rgba(75, 192, 192, 1)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: {
                            stacked: true,
                            ticks: {
                                font: {
                                    size: 14
                                }
                            }
                        },
                        y: {
                            beginAtZero: true,
                            stacked: true,
                            ticks: {
                                font: {
                                    size: 14
                                },
                                stepSize: 10,
                                color: '#000',
                                weight: 'bold'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: {
                                font: {
                                    size: 12
                                }
                            }
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false
                        }
                    }
                }
            });
        })
        .catch(error => console.error('Error fetching efficiency data:', error));
});



</script>

{% endblock %}

{{ redirect_to_login_immediately }}